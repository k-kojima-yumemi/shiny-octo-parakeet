name: Upload Global JSON to S3

on:
  push:
    branches:
      - main
  workflow_dispatch:
    inputs:
      target: 
        description: 'Target Environment'
        required: true
        type: choice
        options:
          - dev
          - stg
          - prod

jobs:
  validation:
    runs-on: ubuntu-latest
    outputs:
      result: ${{steps.validation.outputs.result}}
    steps:
      - name: Do validation
        id: validation
        run: echo "result=true" >> "$GITHUB_OUTPUT"

  upload:
    runs-on: ubuntu-latest
    needs: [validation]
    if: ${{ toJson(needs.validation.outputs.result) == true }}
    steps:
      - name: Check target environment
        id: target
        env:
          TARGET: >-
            ${{
              github.event_name == 'push' && 'dev' || 
              inputs.target
            }}
        run:
          echo "$TARGET"
